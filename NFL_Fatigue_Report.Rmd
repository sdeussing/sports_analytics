---
title: "NFL_Fatigue_Analysis"
author: "Sarah Deussing"
date: "2024-11-11"
output: html_document
---

## Motivation
What is the problem you are considering and why is this an interesting problem? Has this problem been attempted before?

Our analysis will study fatigue in defensive linemen using their speed, acceleration, distance traveled, and orientation. We will be calculating a player load and analyze the defensive player's effectiveness. To do so, we will combine this movement data with play outcome data - if the player sacked the quarterback, had a solo tackle, etc.

## Problem framing
What is the proposed solution to the problem?

## Data overview
What is the dataset you are going to use to solve this problem? Describe the dataset and its characteristics.

The dataset is a part of the NFL Big Data Bowl 2025, and it is taken from:
https://www.kaggle.com/competitions/nfl-big-data-bowl-2025/data 

We are going to use three main parts of the dataset: player_play, players, and the tracking data for each week.

The player_play data contains information about the action of the play, including its outcome or any penalties. Each row corresponds to one player's individual actions for each play within a game.

The plays data contains information about each player, including position, height, weight, and college. We will use this data to filter to only defensive linemen within all datasets.

The tracking data has the x-coordinate, y-coordinate, direction, orientation, speed, and acceleration for each player involved in each play in a game. We will use this movement data to calculate player fatigue. This tracking data is available for all 9 weeks of the season.

## Contribution
Imogen Meers & Sarah Deussing

## R-code
```{r}
library(dplyr)
```


#### Data
Play Data for Each Player
```{r}
play <- read.csv('player_play.csv')
player_data <- read.csv('players.csv')
```


Filter to only defensive linemen.
- DE (Defensive End)
- DT (Defensive Tackle)
- NT (Nose Tackle)
```{r}
def_line <- player_data[player_data$position == 'DE' | player_data$position == 'DT' |
                          player_data$position == 'NT',]

def_line <- play %>%
  left_join(def_line[, c("nflId", "position")], by = "nflId")

def_line <- def_line %>%
  select(-c('hadRushAttempt', 'rushingYards', 'hadDropback', 'passingYards', 'sackYardsAsOffense',
            'hadPassReception', 'receivingYards', 'wasTargettedReceiver', 'yardageGainedAfterTheCatch',
            'fumbles', 'fumbleLost', 'fumbleOutOfBounds', 'wasInitialPassRusher', 'wasRunningRoute',
            'routeRan', 'blockedPlayerNFLId1', 'blockedPlayerNFLId2', 'blockedPlayerNFLId3'))
```

Variables for defensive linemen: 
 - assistedTackle: required an assist to make a tackle
 - forcedFumbleAsDefense: forced a fumble by the opposing team
 - halfSackYardsAsDefense: yards conceded by the offense because of a half-sack
 - passDefensed: a passing play was stopped by the player
 - quarterbackHit: player recorded a QB hit
 - sackYardsAsDefense: yards conceded by the offense because of a sack by the player
 - safetyAsDefense: player forced a safety on this play
 - soloTackle: player recorded a solo tackle on this play
 - tackleAssist: player was awarded an assisted tackle
 - tackleForALoss: player recorded a tackle behind the line of scrimmage
 - tackleForALossYardage: yards conceded by the offense because of a tackle
 - hadInterception: player intercepted a pass
 - interceptionYards: yards returned by the player on an intercepted pass
 - fumbleRecoveries: number of fumbles recovered by the player
 - fumbleRecoveryYards: yards returned by the player on a fumble recovery
 - penaltyNames
 - causedPressure: player pressured the QB
 - timeToPressureAsPassRusher: time elapsed from snap to player reaching a pressure pro. >= to 0.75
 - inMotionAtBallSnap: player was in motion at snap
 - shiftSinceLineset: player shifted since the lineset
 - pressureAllowedAsBlocker: any pass rushers that the blocker had a true matchup against recorded a pressure
 - timeToPressureAllowedAsBlocker: time from snap to pass rusher who blocker had true matchup against achieving a pressure prob. > 0.75
 - pff_defensiveCoverageAssignment: defensive coverage assignment given to the player
 
```{r}
summary(def_line)
```


Tracking
```{r, eval = FALSE}
week1 <- read.csv('tracking_week_1.csv')
```
 
Fatigue variables:
 - s (speed), a (acceleration), dis (distance traveled), dir (direction), o (orientation) 
 
Join Data
```{r}
data <- inner_join(def_line, week1, by = c("gameId", "playId", "nflId"))
colnames(data)
```

Player Load = Acceleration per linemen (per play)
```{r}
data <- data %>%
  group_by(gameId, playId, nflId) %>%
  mutate(load = sum(a, na.rm = TRUE)) %>% ungroup()
```

Plot load Per Player for a game
```{r}
game <- data[data$gameId == 2022090800,]

for (id in unique(game$nflId)) {
  player_data <- game %>% filter(nflId == id)
  p <- ggplot(player_data, aes(x = playId, y = load)) +
    geom_point() + 
    geom_smooth(method = "loess", color = "blue") + 
    labs(x = "Play ID", y = "Load", title = paste0("Player Load in Game - NFL ID: ", id)) +
    theme_minimal()

  print(p)
}
```

